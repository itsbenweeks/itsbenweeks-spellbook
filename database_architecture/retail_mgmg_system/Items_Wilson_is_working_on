
-- Triger created from your trigger

CREATE OR REPLACE TRIGGER NEXT_ORDER 
BEFORE INSERT ON "ORDER" 

for EACH ROW

BEGIN
   
          select order_id_seq.nextval
          into :new."OrderID"
          from dual;
    
END;

-- Trigger that I created to checks number of items available before a new order is inserted. This is not compiling

CREATE OR REPLACE TRIGGER AVAILABLE_QUANTITY
BEFORE INSERT ON "ORDER" 

declare
available number(3,0);
nquantity number(3,0);
notenough exception;

BEGIN
-- get available quantity--
select "Quantity" into available
from INVENTORY
where INVENTORY."ItemSKU" = :new."ItemSKU";

--Query to get the quantity of the new item--
select "Quantity"*:new.quantity into newquantity
from "ItemSKU"
where "ItemSKU" = :new."ItemSKU";

if newquantity > available
RAISE notenough;
end if;

exeption 
when not_enough then
raise_application_error(-2001, "not enough items avaible to purchase!");
end;


-- Query to add new order. It shows a foreing key problem

 update "ORDER"
   set "Date" = '&Date',
   "CustomerID" = &CustomeerID, 
   "ItemSKU" = &ItemSKU,
   "Quantity" = &Quantity, 
   "EmployeeID" = &Employee_ID; 
   
